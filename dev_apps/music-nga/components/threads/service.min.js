(function(n){if("object"===typeof exports&&"undefined"!==typeof module)module.c=n();else if("function"===typeof define&&define.ha)define([],n);else{var g;"undefined"!==typeof window?g=window:"undefined"!==typeof global?g=global:"undefined"!==typeof self?g=self:g=this;g.ma=n()}})(function(){return function g(e,c,f){function m(b,d){if(!c[b]){if(!e[b]){var k="function"==typeof require&&require;if(!d&&k)return k(b,!0);if(l)return l(b,!0);k=Error("Cannot find module '"+b+"'");throw k.code="MODULE_NOT_FOUND",
k;}k=c[b]={c:{}};e[b][0].call(k.c,function(a){var d=e[b][1][a];return m(d?d:a)},k,k.c,g,e,c,f)}return c[b].c}for(var l="function"==typeof require&&require,h=0;h<f.length;h++)m(f[h]);return m}({1:[function(g,e){var c=e.c=self.threads||{};c.service=g("../src/service");"u"!="undefined"[0]?(void 0)([],function(){return c}):self.threads=c},{"../src/service":5}],2:[function(g,e){function c(e){if(e)return Object.assign(e,c.prototype)}e.c=c;c.prototype={h:function(c,e){this.a||(this.a={});this.a[c]||(this.a[c]=
[]);this.a[c].push(e);return this},G:function(c,e){if(this.a)switch(arguments.length){case 0:this.a={};break;case 1:delete this.a[c];break;default:var f=this.a[c];if(!f)return;var b=f.indexOf(e);~b&&f.splice(b,1)}return this},b:function(c,e){if(this.a)for(var f=this.a[c]||[],f=f.concat(this.a["*"]||[]),b=0;b<f.length;b++)f[b].call(this,e,c);return this}};var f=c.prototype;f.off=f.G;f.on=f.h},{}],3:[function(g,e,c){function f(a){this.D=!1;this.C=null;this.s=[];this.f=d();this.onMessage=this.onMessage.bind(this);
this.u=this.u.bind(this);"object"===typeof a?this.ca(a):this.da(a)}function m(a){this.name=a;this.ports=new Set;this.onMessage=this.onMessage.bind(this);this.listen=this.listen.bind(this);this.unlisten=this.unlisten.bind(this)}function l(a){return Error({1:".send() can only be called once",2:"response already sent for this message",3:"a port must be defined",4:"timeout"}[a])}var h=g("./port-adaptors"),b=g("../emitter");g=g("../utils");var d=g.f,k=g.K;c=e.c=function(a){return new f(a)};c.H=function(a){return new m(a)};
c.B=m;c.ga=f;f.prototype={timeout:1E3,da:function(a){this.id=k();this.type=a;this.aa=!1;this.o="*"},ca:function(a){this.F=!1;this.J(a.source||a.target);this.event=a;Object.assign(this,a.data)},J:function(a){this.w=h(a,{ready:!0});return this},set:function(a,d){"object"==typeof a?Object.assign(this,a):this[a]=d;return this},ba:function(){return{id:this.id,type:this.type,data:this.data,o:this.o,g:this.g}},N:function(){this.defaultPrevented=!0},send:function(a){if(this.aa)throw l(1);var d=this.ba(),
b=!this.g;this.port=a?h(a):this.port;if(!this.port)throw l(3);b?(this.m(this.port),this.C=setTimeout(this.u,this.timeout)):this.f.resolve();this.port.postMessage(d,this.T());return this.f.v},T:function(){return this.ea||this.event&&this.event.ports},onMessage:function(a){a.data.response&&a.data.id===this.id&&!this.D&&this.Z(a)},u:function(){this.la||this.f.reject(l(4));this.A()},m:function(a){a=h(a);a.addListener(this.onMessage);this.s.push(a);return this},j:function(){var a=this;this.s.forEach(function(d){return d.removeListener(a.onMessage)});
this.s=[]},L:function(){this.A();this.D=!0;this.b("cancel")},A:function(){clearTimeout(this.C);this.j()},i:function(a){function d(a){c({type:"resolve",value:a})}function b(a){c({type:"reject",value:a&&a.message||a})}function c(a){k.response=a;k.w.postMessage({id:k.id,response:a},k.ea)}if(this.F)throw l(2);if(this.w&&!this.g){var k=this;this.F=!0;a instanceof Error&&b(a);Promise.resolve(a).then(d,b).catch(b)}},M:function(a){var d=this;return this.set("silentTimeout",!0).send(a).then(function(a){return d.i(a.value)})},
Z:function(a){var d=a.data.response,b="reject"==d.type?d.value:d;d.event=a;this.response=d;this.A();this.f[this.response.type](b);this.b("response",d)}};e=f.prototype;e.forward=e.M;e.respond=e.i;e.preventDefault=e.N;e.cancel=e.L;e.send=e.send;e.set=e.set;b(f.prototype);m.prototype={m:function(a){a=h(a||self,{H:!0});if(!this.ports.has(a))return a.addListener(this.onMessage,this.m),this.ports.add(a),this},j:function(){var a=this;this.ports.forEach(function(d){d.removeListener(a.onMessage,a.j)})},onMessage:function(a){if(a.data.id&&
a.data.type&&this.U(a.data.o)&&(a=new f(a),this.b("message",a),!a.defaultPrevented))try{this.b(a.type,a)}catch(d){throw a.i(d),d;}},U:function(a){return a==this.name||"*"==a||"*"==this.name},l:function(){this.j();delete this.name;return this}};e=m.prototype;e.listen=e.m;e.unlisten=e.j;e.destroy=e.l;b(m.prototype)},{"../emitter":2,"../utils":6,"./port-adaptors":4}],4:[function(g,e){function c(d){this.target=d}function f(d,b,a){d.addEventListener(b,a)}var m=g("../utils").f;e.c=function(d,b){if(!d)throw Error({1:"target is undefined"}[1]);
if(d&&d.addListener)return d;var a=h[d.constructor.name];return a?a(d,b):new c(d)};var l=c.prototype={constructor:c,addListener:function(d){this.target.addEventListener("message",d)},removeListener:function(d){this.target.removeEventListener("message",d)},postMessage:function(d,b){this.target.postMessage(d,b)}},h={HTMLIFrameElement:function(d){var c=b(d);return{addListener:function(a){window.addEventListener("message",a)},removeListener:function(a){window.removeEventListener("message",a)},postMessage:function(a,
b){c.then(function(){d.contentWindow.postMessage(a,"*",b)})}}},fa:function(d,b){function a(){var a=m();d.postMessage("ready?");f(d,"message",function p(b){"ready"==b.data&&(d.removeEventListener("message",p),a.resolve())});return a.v}var c=b&&b.H,e=b&&b.ready,e=e||c?Promise.resolve():a();c&&(d.postMessage("ready"),f(d,"message",function(a){"ready?"==a.data&&d.postMessage("ready")}));return{target:d,addListener:l.addListener,removeListener:l.removeListener,postMessage:function(a,b){e.then(function(){return d.postMessage(a,
b)})}}},Window:function(d,c){var a=c&&c.ready||d===self,a=a?Promise.resolve():b(d);return{addListener:function(a){window.addEventListener("message",a)},removeListener:function(a){window.removeEventListener("message",a)},postMessage:function(b,c){a.then(function(){return d.postMessage(b,"*",c)})}}},SharedWorker:function(b){b.port.start();return new c(b.port)},SharedWorkerGlobalScope:function(){var b=[];return{postMessage:function(){},addListener:function(c,a){this.onconnect=function(c){c=c.ports[0];
b.push(c);c.start();a(c)};self.addEventListener("connect",this.onconnect)},removeListener:function(c,a){self.removeEventListener("connect",this.onconnect);b.forEach(function(b){b.close();a(b)})}}}},b=function(){if("undefined"!=typeof window){var b=window.opener||window.parent,c=new WeakSet;b!=self&&f(window,"DOMContentLoaded",function q(){window.removeEventListener("DOMContentLoaded",q);b.postMessage("load","*")});f(self,"message",function(b){return"load"==b.data&&c.add(b.source)});return function(b){var d=
b.contentWindow||b;if(c.has(d)||d==window.parent)return Promise.resolve();var e=m();f(window,"message",function p(b){"load"==b.data&&b.source==d&&(window.removeEventListener("message",p),e.resolve())});return e.v}}}()},{"../utils":6}],5:[function(g,e){function c(b){if(!(this instanceof c))return new c(b);l.B.call(this,b);this.clients={};this.methods={};this.h("_disconnect",this.onDisconnect.bind(this)).h("_connect",this.V.bind(this)).h("_method",this.W.bind(this)).h("_off",this.X.bind(this)).h("_on",
this.Y.bind(this));this.l=this.l.bind(this)}function f(b){return Error({4:'method "'+[].slice.call(arguments,1)[0]+"\" doesn't exist"}[b])}var m=g("./utils").K,l=g("./message"),h=l.B;e.c=c;c.prototype=Object.create(h.prototype);c.prototype.method=function(b,d){this.methods[b]=d;return this};c.prototype.P=function(b,d,c){var a=this;this.R(function(e){c&&!~c.indexOf(e.id)||a.push(b,d,e.id,{g:!0})});return this};c.prototype.push=function(b,d,c,a){a=a&&a.g;var e=this.S(c);return l("_push").set({o:c,g:a,
data:{type:b,data:d}}).send(e.port)};c.prototype.R=function(b){for(var d in this.clients)b(this.clients[d])};c.prototype.S=function(b){return this.clients[b]};c.prototype.V=function(b){var d=b.data,c=d.ja;if(c&&d.ka===this.name&&!this.clients[c]&&(this.b("before-connect",b),!b.defaultPrevented)){if(d=(d=b.event.ports)&&d[0])b.J(d),this.m(d),d.start();this.O(c,b.w);b.i();this.b("connected",c)}};c.prototype.onDisconnect=function(b){var c=this.clients[b.data];c&&(this.b("before-disconnect",b),b.defaultPrevented||
(this.I(c.id),b.i(),this.b("disconnected",c.id)))};c.prototype.W=function(b){this.b("before-method",b);if(!b.defaultPrevented){var c=b.data,e=c.name,a,g=this.methods[e];if(!g)throw f(4,e);try{a=g.apply(this,c.ia)}catch(h){a=h}b.i(a)}};c.prototype.Y=function(b){this.b("on",b.data)};c.prototype.X=function(b){this.b("off",b.data)};c.prototype.O=function(b,c){this.clients[b]={id:b,port:c}};c.prototype.I=function(b){delete this.clients[b]};c.prototype.$=function(b){b(this,{uuid:m});return this};c.prototype.disconnect=
function(b){this.I(b.id);l("disconnect").set({o:b.id,g:!0}).send(b.port)};c.prototype.l=function(){delete this.clients;this.j();this.G()};h=c.prototype;h.broadcast=h.P;h.destroy=h.l;h.method=h.method;h.plugin=h.$},{"./message":3,"./utils":6}],6:[function(g,e,c){c.K=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var e=16*Math.random()|0;return("x"==c?e:e&3|8).toString(16)})};c.f=function(){var c={};c.v=new Promise(function(e,g){c.resolve=e;c.reject=g});return c}},
{}]},{},[1])(1)});
